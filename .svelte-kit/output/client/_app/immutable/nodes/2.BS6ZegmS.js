import{J as de,S as Ce,i as De,s as ye,n as Q,d as g,K as qe,h as _,f as V,L as N,G as p,M as Ie,j as b,m as j,k as A,N as L,o as k,q as w,r as X,z as je,H as W,O as Z,P as R,e as H,l as M,p as U,Q as we}from"../chunks/BwrWARzO.js";import"../chunks/IHki7fMi.js";import{_ as Ee}from"../chunks/C1FmrZbK.js";import{w as he}from"../chunks/MIiKQaen.js";function P(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}const _e=[{id:"scene1",background:"bg_placeholder.png",character:"char_placeholder.png",dialogues:[{name:"캐릭터A",text:"환영합니다! 비주얼 노벨 시작입니다."},{name:"캐릭터B",text:"선택을 준비하세요."}],choices:[{text:"왼쪽 길로 간다",nextScene:"scene2"},{text:"오른쪽 길로 간다",nextScene:"scene3"}],bgm:"bgm_placeholder.mp3"},{id:"scene2",background:"bg_placeholder.png",character:"char_placeholder.png",dialogues:[{name:"캐릭터A",text:"왼쪽 길입니다."},{name:"캐릭터A",text:"여기서 새로운 모험이 시작됩니다."}],choices:[{text:"계속 진행한다",nextScene:"scene4"},{text:"뒤로 돌아간다",nextScene:"scene1"}]},{id:"scene3",background:"bg_placeholder.png",character:"char_placeholder.png",dialogues:[{name:"캐릭터B",text:"오른쪽 길입니다."},{name:"캐릭터B",text:"다른 길로 가보겠습니다."}],choices:[{text:"계속 진행한다",nextScene:"scene4"},{text:"뒤로 돌아간다",nextScene:"scene1"}]},{id:"scene4",background:"bg_placeholder.png",character:"char_placeholder.png",dialogues:[{name:"내레이션",text:"모험의 결말입니다."},{name:"캐릭터A",text:"게임을 완료했습니다!"}],choices:[{text:"처음으로 돌아가기",nextScene:"scene1"}]}],B=he({currentSceneId:"scene1",currentDialogueIndex:0,isShowingChoices:!1,autoSave:!0,playedScenes:new Set}),ve=he(null);function me(){return _e.find(l=>{let e;return B.subscribe(t=>e=t)(),l.id===e.currentSceneId})||null}function Y(l){B.update(t=>(t.currentSceneId=l,t.currentDialogueIndex=0,t.isShowingChoices=!1,t.playedScenes.add(l),t));const e=_e.find(t=>t.id===l);e&&ve.set(e)}function $(){B.update(l=>{const e=me();return e&&(l.currentDialogueIndex<e.dialogues.length-1?l.currentDialogueIndex++:e.choices&&e.choices.length>0&&(l.isShowingChoices=!0)),l})}function xe(l){const e=me();if(!e||!e.choices||l>=e.choices.length)return;const t=e.choices[l];Y(t.nextScene),B.subscribe(n=>{n.autoSave&&Ee(async()=>{const{autoSave:s}=await Promise.resolve().then(()=>Te);return{autoSave:s}},void 0,import.meta.url).then(({autoSave:s})=>s())})()}Y("scene1");const ge="visual_novel_save_",F="visual_novel_auto_save";function pe(l=1){try{const e=de(B),t={gameState:{...e,playedScenes:new Set(e.playedScenes)},timestamp:Date.now(),saveSlot:l},n=JSON.stringify({...t,gameState:{...t.gameState,playedScenes:Array.from(t.gameState.playedScenes)}});return localStorage.setItem(`${ge}${l}`,n),!0}catch(e){return console.error("Save failed:",e),!1}}function Se(l=1){try{const e=localStorage.getItem(`${ge}${l}`);if(!e)return!1;const t=JSON.parse(e),n={...t.gameState,playedScenes:new Set(t.gameState.playedScenes)};return B.set(n),!0}catch(e){return console.error("Load failed:",e),!1}}function Ae(){try{const l=de(B),e={gameState:{...l,playedScenes:Array.from(l.playedScenes)},timestamp:Date.now(),saveSlot:"auto"};return localStorage.setItem(F,JSON.stringify(e)),!0}catch(l){return console.error("Auto save failed:",l),!1}}function be(){try{const l=localStorage.getItem(F);if(!l)return!1;const e=JSON.parse(l),t={...e.gameState,playedScenes:new Set(e.gameState.playedScenes)};return B.set(t),!0}catch(l){return console.error("Auto load failed:",l),!1}}function ke(){return localStorage.getItem(F)!==null}const Te=Object.freeze(Object.defineProperty({__proto__:null,autoSave:Ae,hasAutoSave:ke,loadAutoSave:be,loadGame:Se,saveGame:pe},Symbol.toStringTag,{value:"Module"}));function ee(l,e,t){const n=l.slice();return n[19]=e[t],n[21]=t,n}function te(l,e,t){const n=l.slice();return n[19]=e[t],n[21]=t,n}function le(l,e,t){const n=l.slice();return n[23]=e[t],n[25]=t,n}function ne(l){let e;return{c(){e=k("div"),this.h()},l(t){e=b(t,"DIV",{class:!0,style:!0}),A(e).forEach(g),this.h()},h(){p(e,"class","background svelte-1ud1fqj"),W(e,"background-image","url('/images/backgrounds/"+l[0].background+"')")},m(t,n){V(t,e,n)},p(t,n){n&1&&W(e,"background-image","url('/images/backgrounds/"+t[0].background+"')")},d(t){t&&g(e)}}}function se(l){let e,t,n;return{c(){e=k("div"),t=k("img"),this.h()},l(s){e=b(s,"DIV",{class:!0});var a=A(e);t=b(a,"IMG",{src:!0,alt:!0,class:!0}),a.forEach(g),this.h()},h(){Z(t.src,n="/images/characters/"+l[0].character)||p(t,"src",n),p(t,"alt","Character"),p(t,"class","svelte-1ud1fqj"),p(e,"class","character svelte-1ud1fqj")},m(s,a){V(s,e,a),_(e,t)},p(s,a){a&1&&!Z(t.src,n="/images/characters/"+s[0].character)&&p(t,"src",n)},d(s){s&&g(e)}}}function ae(l){let e,t=P(l[3]),n=[];for(let s=0;s<t.length;s+=1)n[s]=ce(le(l,t,s));return{c(){e=k("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=b(s,"DIV",{class:!0});var a=A(e);for(let c=0;c<n.length;c+=1)n[c].l(a);a.forEach(g),this.h()},h(){p(e,"class","choices-container svelte-1ud1fqj")},m(s,a){V(s,e,a);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null)},p(s,a){if(a&72){t=P(s[3]);let c;for(c=0;c<t.length;c+=1){const f=le(s,t,c);n[c]?n[c].p(f,a):(n[c]=ce(f),n[c].c(),n[c].m(e,null))}for(;c<n.length;c+=1)n[c].d(1);n.length=t.length}},d(s){s&&g(e),R(n,s)}}}function ce(l){let e,t=l[23].text+"",n,s,a,c;function f(){return l[11](l[25])}return{c(){e=k("button"),n=U(t),s=w(),this.h()},l(h){e=b(h,"BUTTON",{class:!0});var o=A(e);n=M(o,t),s=j(o),o.forEach(g),this.h()},h(){p(e,"class","choice-button svelte-1ud1fqj")},m(h,o){V(h,e,o),_(e,n),_(e,s),a||(c=N(e,"click",we(f)),a=!0)},p(h,o){l=h,o&8&&t!==(t=l[23].text+"")&&H(n,t)},d(h){h&&g(e),a=!1,c()}}}function oe(l){let e,t,n=l[4].name+"",s,a,c,f=l[4].text+"",h,o,v,C="▼ 클릭하거나 스페이스키를 누르세요";return{c(){e=k("div"),t=k("div"),s=U(n),a=w(),c=k("div"),h=U(f),o=w(),v=k("div"),v.textContent=C,this.h()},l(r){e=b(r,"DIV",{class:!0});var i=A(e);t=b(i,"DIV",{class:!0});var m=A(t);s=M(m,n),m.forEach(g),a=j(i),c=b(i,"DIV",{class:!0});var u=A(c);h=M(u,f),u.forEach(g),o=j(i),v=b(i,"DIV",{class:!0,"data-svelte-h":!0}),L(v)!=="svelte-k8flop"&&(v.textContent=C),i.forEach(g),this.h()},h(){p(t,"class","character-name svelte-1ud1fqj"),p(c,"class","dialogue-text svelte-1ud1fqj"),p(v,"class","continue-hint svelte-1ud1fqj"),p(e,"class","dialogue-box svelte-1ud1fqj")},m(r,i){V(r,e,i),_(e,t),_(t,s),_(e,a),_(e,c),_(c,h),_(e,o),_(e,v)},p(r,i){i&16&&n!==(n=r[4].name+"")&&H(s,n),i&16&&f!==(f=r[4].text+"")&&H(h,f)},d(r){r&&g(e)}}}function re(l){let e,t,n="저장하기",s,a,c,f,h="닫기",o,v,C=P(Array(5)),r=[];for(let i=0;i<C.length;i+=1)r[i]=ie(te(l,C,i));return{c(){e=k("div"),t=k("h3"),t.textContent=n,s=w(),a=k("div");for(let i=0;i<r.length;i+=1)r[i].c();c=w(),f=k("button"),f.textContent=h,this.h()},l(i){e=b(i,"DIV",{class:!0});var m=A(e);t=b(m,"H3",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-15m2qdz"&&(t.textContent=n),s=j(m),a=b(m,"DIV",{class:!0});var u=A(a);for(let D=0;D<r.length;D+=1)r[D].l(u);u.forEach(g),c=j(m),f=b(m,"BUTTON",{class:!0,"data-svelte-h":!0}),L(f)!=="svelte-z64b8g"&&(f.textContent=h),m.forEach(g),this.h()},h(){p(t,"class","svelte-1ud1fqj"),p(a,"class","save-slots svelte-1ud1fqj"),p(f,"class","close-btn svelte-1ud1fqj"),p(e,"class","save-menu svelte-1ud1fqj")},m(i,m){V(i,e,m),_(e,t),_(e,s),_(e,a);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(a,null);_(e,c),_(e,f),o||(v=N(f,"click",l[15]),o=!0)},p(i,m){if(m&128){C=P(Array(5));let u;for(u=0;u<C.length;u+=1){const D=te(i,C,u);r[u]?r[u].p(D,m):(r[u]=ie(D),r[u].c(),r[u].m(a,null))}for(;u<r.length;u+=1)r[u].d(1);r.length=C.length}},d(i){i&&g(e),R(r,i),o=!1,v()}}}function ie(l){let e,t,n=l[21]+1+"",s,a,c,f;function h(){return l[14](l[21])}return{c(){e=k("button"),t=U("슬롯 "),s=U(n),a=w(),this.h()},l(o){e=b(o,"BUTTON",{class:!0});var v=A(e);t=M(v,"슬롯 "),s=M(v,n),a=j(v),v.forEach(g),this.h()},h(){p(e,"class","save-slot svelte-1ud1fqj")},m(o,v){V(o,e,v),_(e,t),_(e,s),_(e,a),c||(f=N(e,"click",h),c=!0)},p(o,v){l=o},d(o){o&&g(e),c=!1,f()}}}function ue(l){let e,t,n="불러오기",s,a,c,f,h="닫기",o,v,C=P(Array(5)),r=[];for(let i=0;i<C.length;i+=1)r[i]=fe(ee(l,C,i));return{c(){e=k("div"),t=k("h3"),t.textContent=n,s=w(),a=k("div");for(let i=0;i<r.length;i+=1)r[i].c();c=w(),f=k("button"),f.textContent=h,this.h()},l(i){e=b(i,"DIV",{class:!0});var m=A(e);t=b(m,"H3",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-15xe4is"&&(t.textContent=n),s=j(m),a=b(m,"DIV",{class:!0});var u=A(a);for(let D=0;D<r.length;D+=1)r[D].l(u);u.forEach(g),c=j(m),f=b(m,"BUTTON",{class:!0,"data-svelte-h":!0}),L(f)!=="svelte-sxuwl1"&&(f.textContent=h),m.forEach(g),this.h()},h(){p(t,"class","svelte-1ud1fqj"),p(a,"class","save-slots svelte-1ud1fqj"),p(f,"class","close-btn svelte-1ud1fqj"),p(e,"class","load-menu svelte-1ud1fqj")},m(i,m){V(i,e,m),_(e,t),_(e,s),_(e,a);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(a,null);_(e,c),_(e,f),o||(v=N(f,"click",l[17]),o=!0)},p(i,m){if(m&256){C=P(Array(5));let u;for(u=0;u<C.length;u+=1){const D=ee(i,C,u);r[u]?r[u].p(D,m):(r[u]=fe(D),r[u].c(),r[u].m(a,null))}for(;u<r.length;u+=1)r[u].d(1);r.length=C.length}},d(i){i&&g(e),R(r,i),o=!1,v()}}}function fe(l){let e,t,n=l[21]+1+"",s,a,c,f;function h(){return l[16](l[21])}return{c(){e=k("button"),t=U("슬롯 "),s=U(n),a=w(),this.h()},l(o){e=b(o,"BUTTON",{class:!0});var v=A(e);t=M(v,"슬롯 "),s=M(v,n),a=j(v),v.forEach(g),this.h()},h(){p(e,"class","save-slot svelte-1ud1fqj")},m(o,v){V(o,e,v),_(e,t),_(e,s),_(e,a),c||(f=N(e,"click",h),c=!0)},p(o,v){l=o},d(o){o&&g(e),c=!1,f()}}}function Ve(l){let e,t,n,s,a,c,f,h,o,v="저장하기",C,r,i="불러오기",m,u,D,z,J,y=l[0]&&ne(l),q=l[0]&&se(l),I=l[3].length>0&&ae(l),d=l[4]&&oe(l),E=l[1]&&re(l),x=l[2]&&ue(l);return{c(){e=k("meta"),t=w(),n=k("main"),s=k("div"),y&&y.c(),a=w(),q&&q.c(),c=w(),I&&I.c(),f=w(),h=k("div"),o=k("button"),o.textContent=v,C=w(),r=k("button"),r.textContent=i,m=w(),d&&d.c(),u=w(),E&&E.c(),D=w(),x&&x.c(),this.h()},l(S){const T=Ie("svelte-hq575f",document.head);e=b(T,"META",{name:!0,content:!0}),T.forEach(g),t=j(S),n=b(S,"MAIN",{class:!0});var O=A(n);s=b(O,"DIV",{class:!0});var G=A(s);y&&y.l(G),a=j(G),q&&q.l(G),c=j(G),I&&I.l(G),G.forEach(g),f=j(O),h=b(O,"DIV",{class:!0});var K=A(h);o=b(K,"BUTTON",{class:!0,"data-svelte-h":!0}),L(o)!=="svelte-1h52fyk"&&(o.textContent=v),C=j(K),r=b(K,"BUTTON",{class:!0,"data-svelte-h":!0}),L(r)!=="svelte-16wus8x"&&(r.textContent=i),K.forEach(g),m=j(O),d&&d.l(O),u=j(O),E&&E.l(O),D=j(O),x&&x.l(O),O.forEach(g),this.h()},h(){document.title="Visual Novel Game",p(e,"name","description"),p(e,"content","SvelteKit + Capacitor Visual Novel Game"),p(s,"class","game-screen svelte-1ud1fqj"),p(o,"class","control-btn svelte-1ud1fqj"),p(r,"class","control-btn svelte-1ud1fqj"),p(h,"class","ui-controls svelte-1ud1fqj"),p(n,"class","game-container svelte-1ud1fqj")},m(S,T){_(document.head,e),V(S,t,T),V(S,n,T),_(n,s),y&&y.m(s,null),_(s,a),q&&q.m(s,null),_(s,c),I&&I.m(s,null),_(n,f),_(n,h),_(h,o),_(h,C),_(h,r),_(n,m),d&&d.m(n,null),_(n,u),E&&E.m(n,null),_(n,D),x&&x.m(n,null),z||(J=[N(s,"click",l[5]),N(o,"click",l[12]),N(r,"click",l[13])],z=!0)},p(S,[T]){S[0]?y?y.p(S,T):(y=ne(S),y.c(),y.m(s,a)):y&&(y.d(1),y=null),S[0]?q?q.p(S,T):(q=se(S),q.c(),q.m(s,c)):q&&(q.d(1),q=null),S[3].length>0?I?I.p(S,T):(I=ae(S),I.c(),I.m(s,null)):I&&(I.d(1),I=null),S[4]?d?d.p(S,T):(d=oe(S),d.c(),d.m(n,u)):d&&(d.d(1),d=null),S[1]?E?E.p(S,T):(E=re(S),E.c(),E.m(n,D)):E&&(E.d(1),E=null),S[2]?x?x.p(S,T):(x=ue(S),x.c(),x.m(n,null)):x&&(x.d(1),x=null)},i:Q,o:Q,d(S){S&&(g(t),g(n)),g(e),y&&y.d(),q&&q.d(),I&&I.d(),d&&d.d(),E&&E.d(),x&&x.d(),z=!1,qe(J)}}}function Oe(l,e,t){let n,s,a,c;X(l,ve,d=>t(0,a=d)),X(l,B,d=>t(10,c=d));let f=!1,h=!1,o=null;je(()=>(ke()&&confirm("자동 저장된 데이터를 불러오시겠습니까?")&&be(),Y("scene1"),window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v),o&&o.pause()}));function v(d){d.code==="Space"&&(d.preventDefault(),c.isShowingChoices||$())}function C(){c.isShowingChoices||$()}function r(d){xe(d),t(1,f=!1),t(2,h=!1)}function i(d){pe(d)?alert(`슬롯 ${d}에 저장되었습니다.`):alert("저장에 실패했습니다."),t(1,f=!1)}function m(d){Se(d)?alert(`슬롯 ${d}에서 불러왔습니다.`):alert("불러오기에 실패했습니다."),t(2,h=!1)}const u=d=>r(d),D=()=>t(1,f=!f),z=()=>t(2,h=!h),J=d=>i(d+1),y=()=>t(1,f=!1),q=d=>m(d+1),I=()=>t(2,h=!1);return l.$$.update=()=>{l.$$.dirty&1025&&t(4,n=a&&c.currentDialogueIndex<a.dialogues.length?a.dialogues[c.currentDialogueIndex]:null),l.$$.dirty&1025&&t(3,s=a&&c.isShowingChoices?a.choices||[]:[]),l.$$.dirty&513&&a&&a.bgm&&(o&&o.pause(),t(9,o=new Audio(`/sounds/bgm/${a.bgm}`)),t(9,o.loop=!0,o),t(9,o.volume=.5,o),o.play().catch(d=>console.log("BGM play failed:",d)))},[a,f,h,s,n,C,r,i,m,o,c,u,D,z,J,y,q,I]}class Ue extends Ce{constructor(e){super(),De(this,e,Oe,Ve,ye,{})}}export{Ue as component};
